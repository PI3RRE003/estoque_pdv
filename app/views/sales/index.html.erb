<% content_for :title, "Histórico de Vendas" %>

<div class="max-w-7xl mx-auto">
  <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
    <div>
      <h1 class="text-4xl font-black text-white italic tracking-tighter uppercase">Relatório de <span class="text-orange-500">Vendas</span></h1>
      <p class="text-zinc-500 text-sm">Gerencie o histórico e acompanhe o faturamento.</p>
    </div>
    <%= link_to 'NOVA VENDA (PDV)', new_sale_path, class: "bg-orange-600 hover:bg-orange-500 text-white font-black py-4 px-8 rounded-2xl transition-all shadow-[0_0_20px_rgba(234,88,12,0.3)] italic tracking-tighter uppercase text-xs" %>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-zinc-900 border border-zinc-800 p-6 rounded-3xl shadow-xl relative overflow-hidden">
      <div class="absolute -right-4 -top-4 w-24 h-24 bg-orange-600/10 blur-3xl rounded-full"></div>
      <p class="text-zinc-500 text-[10px] font-black uppercase tracking-widest mb-1 italic">Total no Período</p>
      <h2 class="text-3xl font-black text-white italic tracking-tighter">
        <%= number_to_currency(@sales.sum(:total), unit: "R$ ", separator: ",", delimiter: ".") %>
      </h2>
    </div>
    
    <div class="bg-zinc-900 border border-zinc-800 p-6 rounded-3xl shadow-xl">
      <p class="text-zinc-500 text-[10px] font-black uppercase tracking-widest mb-1 italic">Vendas Realizadas</p>
      <h2 class="text-3xl font-black text-white italic tracking-tighter">
        <%= @sales.count %> <span class="text-zinc-700 text-sm">unids</span>
      </h2>
    </div>
    
    <div class="bg-zinc-900 border border-zinc-800 p-6 rounded-3xl shadow-xl">
      <p class="text-zinc-500 text-[10px] font-black uppercase tracking-widest mb-1 italic">Ticket Médio</p>
      <h2 class="text-3xl font-black text-white italic tracking-tighter">
        <%= number_to_currency(@sales.average(:total) || 0, unit: "R$ ", separator: ",", delimiter: ".") %>
      </h2>
    </div>
  </div>

  <div class="bg-zinc-900 border border-zinc-800 p-6 rounded-3xl mb-8 shadow-xl">
    <%= form_with url: sales_path, method: :get, class: "grid grid-cols-1 md:grid-cols-4 gap-4 items-end" do |f| %>
      <div>
        <label class="block text-zinc-500 text-[10px] font-bold uppercase tracking-widest mb-2 text-white italic">Nº do Cupom (DOC)</label>
        <%= f.text_field :query, value: params[:query], placeholder: "Ex: 000123", class: "w-full bg-zinc-950 border-2 border-zinc-800 text-white rounded-xl p-3 focus:border-orange-600 outline-none text-sm transition-all" %>
      </div>

      <div>
        <label class="block text-zinc-500 text-[10px] font-bold uppercase tracking-widest mb-2 text-white italic">Data Inicial</label>
        <%= f.date_field :start_date, value: params[:start_date], class: "w-full bg-zinc-950 border-2 border-zinc-800 text-white rounded-xl p-3 focus:border-orange-600 outline-none text-sm transition-all" %>
      </div>

      <div>
        <label class="block text-zinc-500 text-[10px] font-bold uppercase tracking-widest mb-2 text-white italic">Data Final</label>
        <%= f.date_field :end_date, value: params[:end_date], class: "w-full bg-zinc-950 border-2 border-zinc-800 text-white rounded-xl p-3 focus:border-orange-600 outline-none text-sm transition-all" %>
      </div>

      <div class="flex gap-2">
        <%= f.submit "FILTRAR", class: "flex-grow bg-zinc-800 hover:bg-zinc-700 text-white font-black py-3 px-4 rounded-xl transition-all cursor-pointer text-xs" %>
        <%= link_to "LIMPAR", sales_path, class: "bg-zinc-950 border border-zinc-800 text-zinc-500 hover:text-white py-3 px-4 rounded-xl transition-all text-xs flex items-center justify-center" %>
      </div>
    <% end %>
  </div>

  <div class="bg-zinc-900 border border-zinc-800 rounded-3xl overflow-hidden shadow-2xl">
    <table class="w-full text-left border-collapse">
      <thead>
        <tr class="bg-zinc-800/50 text-zinc-400 text-[10px] uppercase tracking-widest">
          <th class="p-6 border-b border-zinc-800">Cód / Data</th>
          <th class="p-6 border-b border-zinc-800">Cliente</th>
          <th class="p-6 border-b border-zinc-800">Pagamento</th>
          <th class="p-6 border-b border-zinc-800">Total Líquido</th>
          <th class="p-6 text-right border-b border-zinc-800 font-bold">Ações</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-zinc-800">
        <% if @sales.any? %>
          <% @sales.each do |sale| %>
            <tr class="hover:bg-zinc-800/30 transition-colors group">
              <td class="p-6">
                <div class="text-white font-bold">#<%= sale.id.to_s.rjust(6, '0') %></div>
                <div class="text-[10px] text-zinc-600 font-mono italic"><%= sale.created_at.strftime("%d/%m/%Y %H:%M") %></div>
              </td>
              
              <td class="p-6 text-zinc-300">
                <div class="flex items-center gap-2">
                  <div class="w-2 h-2 rounded-full <%= sale.client.present? ? 'bg-orange-500 shadow-[0_0_8px_#ea580c]' : 'bg-zinc-700' %>"></div>
                  <span class="text-sm italic"><%= sale.client&.name.present? ? sale.client.name : "Consumidor Final" %></span>
                </div>
              </td>
              
              <td class="p-6">
                <span class="px-3 py-1 bg-zinc-950 text-zinc-400 text-[10px] font-black rounded-lg border border-zinc-800 uppercase tracking-tighter italic">
                  <%= sale.payment_method&.upcase || "N/A" %>
                </span>
              </td>
              
              <td class="p-6 font-black text-white text-xl tracking-tighter italic">
                <%= number_to_currency(sale.total, unit: "R$ ", separator: ",", delimiter: ".") %>
              </td>
              
              <td class="p-6 text-right">
                <div class="flex justify-end gap-2">
                  <%# LINK PARA VER DETALHES (SHOW) %>
                  <%= link_to sale, title: "Ver Detalhes", class: "inline-flex items-center justify-center w-10 h-10 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 rounded-xl transition-all border border-zinc-700" do %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                  <% end %>

                  <%# LINK PARA IMPRIMIR CUPOM 80MM (REPETIR IMPRESSÃO) %>
                  <%= link_to receipt_sale_path(sale), title: "Reimprimir Cupom", target: "_blank", class: "inline-flex items-center justify-center w-10 h-10 bg-zinc-800 hover:bg-orange-600 text-zinc-400 hover:text-white rounded-xl transition-all border border-zinc-700 shadow-lg" do %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                    </svg>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="5" class="p-20 text-center">
              <div class="flex flex-col items-center gap-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-zinc-800" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 9.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="text-zinc-600 italic">Nenhuma venda encontrada para os filtros aplicados.</p>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>