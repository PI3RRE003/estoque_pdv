<div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
  <div>
    <h1 class="text-4xl font-black text-white italic tracking-tighter uppercase">
      DASHBOARD <span class="text-orange-500">OPERACIONAL</span>
    </h1>
    <p class="text-zinc-500">
      <% if params[:start_date].present? %>
        Mostrando resultados de <%= @start_date.strftime("%d/%m/%Y") %> até <%= @end_date.strftime("%d/%m/%Y") %>
      <% else %>
        Visão geral do seu negócio em tempo real.
      <% end %>
    </p>
  </div>

  <%= link_to fechamento_path(date: @start_date.to_date), target: "_blank", class: "group bg-zinc-900 hover:bg-orange-600 border border-zinc-800 hover:border-orange-500 text-white px-6 py-3 rounded-2xl text-xs font-bold transition-all flex items-center gap-3 shadow-xl" do %>
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-500 group-hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    </svg>
    IMPRIMIR FECHAMENTO (<%= @start_date.strftime("%d/%m") %>)
  <% end %>
</div>

<%# FILTROS %>
<div class="bg-zinc-900 border border-zinc-800 p-4 rounded-3xl mb-10 shadow-xl">
  <%= form_with url: root_path, method: :get, class: "flex flex-wrap items-end gap-4" do |f| %>
    <div class="flex-grow">
      <label class="text-zinc-500 text-[10px] font-bold uppercase mb-2 block tracking-widest">Data Inicial</label>
      <%= f.date_field :start_date, value: @start_date.to_date, class: "w-full bg-zinc-950 border-2 border-zinc-800 text-white rounded-xl p-2.5 focus:border-orange-600 outline-none transition-all text-sm" %>
    </div>
    <div class="flex-grow">
      <label class="text-zinc-500 text-[10px] font-bold uppercase mb-2 block tracking-widest">Data Final</label>
      <%= f.date_field :end_date, value: @end_date.to_date, class: "w-full bg-zinc-950 border-2 border-zinc-800 text-white rounded-xl p-2.5 focus:border-orange-600 outline-none transition-all text-sm" %>
    </div>
    <div class="flex gap-2">
      <%= f.submit "FILTRAR", class: "bg-orange-600 hover:bg-orange-500 text-white font-black px-6 py-3 rounded-xl transition-all cursor-pointer text-xs" %>
      <%= link_to "HOJE", root_path, class: "bg-zinc-800 hover:bg-zinc-700 text-zinc-400 px-6 py-3 rounded-xl transition-all text-xs font-black" %>
    </div>
  <% end %>
</div>

<%# CARDS PRINCIPAIS %>
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
  <div class="bg-zinc-900 border border-zinc-800 p-6 rounded-3xl shadow-xl">
    <span class="text-zinc-500 text-xs font-bold uppercase tracking-widest">Faturamento</span>
    <div class="mt-2 text-3xl font-black text-white">
      <%= number_to_currency(@revenue_today.to_f, unit: "R$ ", separator: ",", delimiter: ".") %>
    </div>
  </div>

  <div class="bg-zinc-900 border border-zinc-800 p-6 rounded-3xl shadow-xl border-b-4 border-b-green-600">
    <span class="text-zinc-500 text-xs font-bold uppercase tracking-widest text-green-500">Lucro Estimado</span>
    <div class="mt-2 text-3xl font-black text-white">
      <%= number_to_currency(@profit_today.to_f, unit: "R$ ", separator: ",", delimiter: ".") %>
    </div>
  </div>

  <div class="bg-zinc-900 border border-zinc-800 p-6 rounded-3xl shadow-xl">
    <span class="text-zinc-500 text-xs font-bold uppercase tracking-widest text-white">Total Vendas</span>
    <div class="mt-2 text-3xl font-black text-white tracking-tighter"><%= @sales_count %></div>
  </div>

  <div class="bg-zinc-900 border border-zinc-800 p-6 rounded-3xl shadow-xl border-l-4 border-l-orange-600">
    <span class="text-zinc-500 text-xs font-bold uppercase tracking-widest text-orange-500">Itens Críticos</span>
    <% @critical_products = Product.where("active = ? AND stock_quantity < 10", true) %>
    <div class="mt-2 text-3xl font-black text-white tracking-tighter"><%= @critical_products.count %></div>
  </div>
</div>

<%# GRÁFICOS %>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
  <div class="bg-zinc-900 border border-zinc-800 p-8 rounded-3xl shadow-2xl">
    <h3 class="text-white font-bold flex items-center gap-2 mb-6 uppercase text-xs tracking-widest">
      <div class="w-2 h-2 bg-orange-500 rounded-full"></div> Desempenho Financeiro
    </h3>
    <div class="h-[300px]">
      <%= line_chart @sales_by_day, prefix: "R$ ", colors: ["#ea580c"], library: { 
          scales: { 
            y: { ticks: { color: '#71717a' }, grid: { color: '#27272a' } }, 
            x: { ticks: { color: '#71717a' }, grid: { display: false } } 
          } 
        } %>
    </div>
  </div>

  <div class="bg-zinc-900 border border-zinc-800 p-8 rounded-3xl shadow-2xl">
    <h3 class="text-white font-bold mb-6 flex items-center gap-2 uppercase text-xs tracking-widest">
      <div class="w-2 h-2 bg-orange-500 rounded-full"></div> Meios de Pagamento
    </h3>
    <div class="h-[300px]">
      <%= pie_chart @sales_by_payment, colors: ["#ea580c", "#f97316", "#fb923c", "#fdba74"], library: { plugins: { legend: { position: 'bottom', labels: { color: '#71717a' } } } } %>
    </div>
  </div>
</div>

<%# LISTA DE ESTOQUE CRÍTICO %>
<%# LISTA DE ESTOQUE CRÍTICO %>
<div class="bg-zinc-900 border border-zinc-800 rounded-3xl shadow-2xl overflow-hidden">
  <div class="p-6 border-b border-zinc-800 flex justify-between items-center">
    <h3 class="text-white font-bold flex items-center gap-2 uppercase text-xs tracking-widest">
      <div class="w-2 h-2 bg-red-600 rounded-full animate-pulse"></div> Atenção: Estoque Crítico
    </h3>
    <span class="text-zinc-500 text-[10px] font-bold">LIMITE: 10 UNIDADES</span>
  </div>
  <div class="overflow-x-auto">
    <table class="w-full text-left border-collapse">
      <thead>
        <tr class="bg-zinc-950 text-zinc-500 text-[10px] uppercase tracking-widest">
          <th class="p-4">Produto</th>
          <th class="p-4 text-center">Qtd Atual</th>
          <th class="p-4 text-right pr-8">Status</th>
          <th class="p-4 text-right pr-6">Ação</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-zinc-800">
        <% if @critical_products.any? %>
          <% @critical_products.each do |product| %>
            <tr class="hover:bg-zinc-800/30 transition-colors group">
              <td class="p-4 pl-6">
                <div class="text-white font-black uppercase italic text-sm tracking-tighter"><%= product.name %></div>
                <div class="text-[10px] text-zinc-600 font-mono">ID: #<%= product.id.to_s.rjust(4, '0') %></div>
              </td>
              
              <td class="p-4 text-center">
                <span class="px-3 py-1 bg-red-950/30 text-red-500 border border-red-900/50 rounded-full font-black text-xs">
                  <%= product.stock_quantity %> un
                </span>
              </td>

              <td class="p-4 text-right pr-8">
                <% if product.stock_quantity <= 0 %>
                  <span class="text-[9px] font-black text-zinc-500 uppercase italic">Esgotado</span>
                <% else %>
                  <span class="text-[9px] font-black text-orange-600 uppercase italic">Repor Urgente</span>
                <% end %>
              </td>

              <td class="p-4 text-right pr-6">
                <%= link_to edit_product_path(product), class: "inline-flex items-center justify-center bg-zinc-800 hover:bg-zinc-700 text-white w-8 h-8 rounded-lg transition-all border border-zinc-700" do %>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="4" class="p-10 text-center text-zinc-600 italic text-sm">
              Tudo sob controle! Nenhum produto abaixo do limite.
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>